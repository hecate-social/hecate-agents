%%% Query: get a {{aggregate}} by ID
%%% Domain: query_{{aggregates}}

-module(get_{{aggregate}}_by_id).

-export([execute/1]).

-spec execute(binary()) -> {ok, map()} | {error, not_found | term()}.
execute(Id) ->
    Sql = "SELECT {{aggregate}}_id, name, status, status_label, initiated_at "
          "FROM {{aggregates}} WHERE {{aggregate}}_id = ?1",
    case query_{{aggregates}}_store:query(Sql, [Id]) of
        {ok, [Row]} ->
            {ok, row_to_map(Row)};
        {ok, []} ->
            {error, not_found};
        {error, Reason} ->
            {error, Reason}
    end.

row_to_map([Id, Name, Status, StatusLabel, InitiatedAt]) ->
    #{
        {{aggregate}}_id => Id,
        name => Name,
        status => Status,
        status_label => StatusLabel,
        initiated_at => InitiatedAt
    }.
