%%% API handler: get {{aggregate}} by ID
%%% Route: GET /api/{{aggregates}}/:{{aggregate}}_id

-module(get_{{aggregate}}_by_id_api).
-export([init/2]).

init(Req0, State) ->
    case cowboy_req:method(Req0) of
        <<"GET">> -> handle_get(Req0, State);
        _ -> hecate_api_utils:method_not_allowed(Req0)
    end.

handle_get(Req0, _State) ->
    Id = cowboy_req:binding({{aggregate}}_id, Req0),
    case get_{{aggregate}}_by_id:execute(Id) of
        {ok, Record} ->
            hecate_api_utils:json_ok(#{{{aggregate}} => Record}, Req0);
        {error, not_found} ->
            hecate_api_utils:not_found(Req0);
        {error, Reason} ->
            hecate_api_utils:json_error(500, Reason, Req0)
    end.
