<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1060 880" font-family="monospace" font-size="13">
  <defs>
    <marker id="arrow" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 z" fill="#555"/>
    </marker>
    <marker id="arrow-purple" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 z" fill="#8b5cf6"/>
    </marker>
    <marker id="arrow-amber" viewBox="0 0 10 6" refX="10" refY="3" markerWidth="10" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0 L10,3 L0,6 z" fill="#f59e0b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1060" height="880" fill="#0f1117" rx="8"/>

  <!-- Title -->
  <text x="530" y="32" fill="#e2e8f0" font-size="18" font-weight="bold" text-anchor="middle">Hecate App Architecture (Single-Node k3s)</text>

  <!-- ========== HOST MACHINE boundary ========== -->
  <rect x="20" y="50" width="1020" height="820" rx="6" fill="none" stroke="#475569" stroke-width="1.5" stroke-dasharray="8,4"/>
  <text x="40" y="72" fill="#94a3b8" font-size="12">HOST MACHINE</text>

  <!-- ========== hecate-web (desktop app) ========== -->
  <rect x="310" y="85" width="440" height="100" rx="6" fill="#1e293b" stroke="#8b5cf6" stroke-width="2"/>
  <text x="530" y="110" fill="#c4b5fd" font-size="14" font-weight="bold" text-anchor="middle">hecate-web</text>
  <text x="530" y="128" fill="#94a3b8" font-size="11" text-anchor="middle">Tauri v2 Desktop App (Native Browser) -- installed via script, NOT k3s</text>
  <rect x="330" y="140" width="130" height="30" rx="4" fill="#312e81" stroke="#6366f1" stroke-width="1"/>
  <text x="395" y="160" fill="#a5b4fc" font-size="11" text-anchor="middle">Main WebView</text>
  <rect x="490" y="140" width="120" height="30" rx="4" fill="#312e81" stroke="#6366f1" stroke-width="1"/>
  <text x="550" y="160" fill="#a5b4fc" font-size="11" text-anchor="middle">Trader View</text>
  <rect x="620" y="140" width="120" height="30" rx="4" fill="#312e81" stroke="#6366f1" stroke-width="1"/>
  <text x="680" y="160" fill="#a5b4fc" font-size="11" text-anchor="middle">Martha View</text>

  <!-- ========== ~/.hecate/ Shared Filesystem ========== -->
  <rect x="40" y="210" width="980" height="100" rx="4" fill="#1c1917" stroke="#78716c" stroke-width="1.5"/>
  <text x="60" y="232" fill="#d6d3d1" font-size="12" font-weight="bold">~/.hecate/ (hostPath volume, shared between host + pods) -- DAEMONS OWN SOCKETS</text>

  <!-- gitops -->
  <rect x="60" y="242" width="140" height="28" rx="3" fill="#1e1b2e" stroke="#7c3aed" stroke-width="1"/>
  <text x="130" y="261" fill="#c4b5fd" font-size="10" text-anchor="middle">gitops/</text>
  <text x="130" y="301" fill="#a78bfa" font-size="9" text-anchor="middle">Flux source</text>

  <!-- hecate-daemon namespace -->
  <rect x="220" y="242" width="220" height="55" rx="3" fill="#292524" stroke="#3b82f6" stroke-width="1"/>
  <text x="330" y="259" fill="#93c5fd" font-size="10" text-anchor="middle">hecate-daemon/</text>
  <text x="330" y="275" fill="#64748b" font-size="8" text-anchor="middle">sockets/api.sock (well-known)</text>
  <text x="330" y="289" fill="#64748b" font-size="8" text-anchor="middle">sqlite/ reckon-db/ run/ connectors/</text>

  <!-- hecate-traderd namespace -->
  <rect x="460" y="242" width="220" height="55" rx="3" fill="#292524" stroke="#22c55e" stroke-width="1"/>
  <text x="570" y="259" fill="#86efac" font-size="10" text-anchor="middle">hecate-traderd/</text>
  <text x="570" y="275" fill="#64748b" font-size="8" text-anchor="middle">sockets/api.sock</text>
  <text x="570" y="289" fill="#64748b" font-size="8" text-anchor="middle">sqlite/ reckon-db/ run/ connectors/</text>

  <!-- hecate-marthad namespace -->
  <rect x="700" y="242" width="300" height="55" rx="3" fill="#292524" stroke="#f43f5e" stroke-width="1"/>
  <text x="850" y="259" fill="#fca5a5" font-size="10" text-anchor="middle">hecate-marthad/</text>
  <text x="850" y="275" fill="#64748b" font-size="8" text-anchor="middle">sockets/api.sock | hecate-agents/ (knowledge)</text>
  <text x="850" y="289" fill="#64748b" font-size="8" text-anchor="middle">sqlite/ reckon-db/ run/ connectors/</text>

  <!-- ========== k3s boundary ========== -->
  <rect x="40" y="330" width="980" height="420" rx="6" fill="none" stroke="#0ea5e9" stroke-width="1.5"/>
  <text x="60" y="352" fill="#38bdf8" font-size="12" font-weight="bold">k3s (single-node: server + agent) -- all deployed via ~/.hecate/gitops/</text>

  <!-- ========== hecate-daemon pod ========== -->
  <rect x="60" y="370" width="240" height="170" rx="5" fill="#172554" stroke="#3b82f6" stroke-width="2"/>
  <text x="180" y="395" fill="#93c5fd" font-size="13" font-weight="bold" text-anchor="middle">hecate-daemon</text>
  <text x="180" y="412" fill="#60a5fa" font-size="10" text-anchor="middle">DaemonSet (Erlang/OTP)</text>
  <rect x="75" y="425" width="210" height="20" rx="3" fill="#1e3a5f" stroke="#2563eb" stroke-width="1"/>
  <text x="180" y="439" fill="#93c5fd" font-size="10" text-anchor="middle">Event Store (ReckonDB)</text>
  <rect x="75" y="450" width="210" height="20" rx="3" fill="#1e3a5f" stroke="#2563eb" stroke-width="1"/>
  <text x="180" y="464" fill="#93c5fd" font-size="10" text-anchor="middle">SQLite Read Models</text>
  <rect x="75" y="475" width="210" height="20" rx="3" fill="#1e3a5f" stroke="#2563eb" stroke-width="1"/>
  <text x="180" y="489" fill="#93c5fd" font-size="10" text-anchor="middle">Plugin Registry</text>
  <rect x="75" y="500" width="210" height="20" rx="3" fill="#1e3a5f" stroke="#2563eb" stroke-width="1"/>
  <text x="180" y="514" fill="#93c5fd" font-size="10" text-anchor="middle">Mesh Gateway (Macula/QUIC)</text>
  <rect x="75" y="525" width="210" height="10" rx="2" fill="#2563eb" opacity="0.3"/>

  <!-- ========== hecate-traderd pod ========== -->
  <rect x="340" y="370" width="240" height="140" rx="5" fill="#14532d" stroke="#22c55e" stroke-width="2"/>
  <text x="460" y="395" fill="#86efac" font-size="13" font-weight="bold" text-anchor="middle">hecate-traderd</text>
  <text x="460" y="412" fill="#4ade80" font-size="10" text-anchor="middle">DaemonSet (Erlang/OTP)</text>
  <rect x="355" y="425" width="210" height="20" rx="3" fill="#1a3d2a" stroke="#16a34a" stroke-width="1"/>
  <text x="460" y="439" fill="#86efac" font-size="10" text-anchor="middle">Trading Domain Logic</text>
  <rect x="355" y="450" width="210" height="20" rx="3" fill="#1a3d2a" stroke="#16a34a" stroke-width="1"/>
  <text x="460" y="464" fill="#86efac" font-size="10" text-anchor="middle">SQLite Read Models</text>
  <rect x="355" y="475" width="210" height="20" rx="3" fill="#1a3d2a" stroke="#16a34a" stroke-width="1"/>
  <text x="460" y="489" fill="#86efac" font-size="10" text-anchor="middle">Event Store (local streams)</text>

  <!-- ========== hecate-marthad pod ========== -->
  <rect x="620" y="370" width="240" height="140" rx="5" fill="#4c0519" stroke="#f43f5e" stroke-width="2"/>
  <text x="740" y="395" fill="#fda4af" font-size="13" font-weight="bold" text-anchor="middle">hecate-marthad</text>
  <text x="740" y="412" fill="#fb7185" font-size="10" text-anchor="middle">DaemonSet (Erlang/OTP)</text>
  <rect x="635" y="425" width="210" height="20" rx="3" fill="#5c0a1e" stroke="#e11d48" stroke-width="1"/>
  <text x="740" y="439" fill="#fda4af" font-size="10" text-anchor="middle">DevOps AI Agent Logic</text>
  <rect x="635" y="450" width="210" height="20" rx="3" fill="#5c0a1e" stroke="#e11d48" stroke-width="1"/>
  <text x="740" y="464" fill="#fda4af" font-size="10" text-anchor="middle">SQLite Read Models</text>
  <rect x="635" y="475" width="210" height="20" rx="3" fill="#5c0a1e" stroke="#e11d48" stroke-width="1"/>
  <text x="740" y="489" fill="#fda4af" font-size="10" text-anchor="middle">hecate-agents/ (knowledge)</text>

  <!-- ========== Frontend pods ========== -->
  <!-- Note: frontends are stateless, they connect TO daemon sockets -->
  <rect x="340" y="535" width="170" height="80" rx="5" fill="#451a03" stroke="#f59e0b" stroke-width="2"/>
  <text x="425" y="558" fill="#fcd34d" font-size="12" font-weight="bold" text-anchor="middle">hecate-traderw</text>
  <text x="425" y="573" fill="#fbbf24" font-size="10" text-anchor="middle">DaemonSet (Web UI)</text>
  <rect x="352" y="585" width="146" height="20" rx="3" fill="#3d2a0a" stroke="#d97706" stroke-width="1"/>
  <text x="425" y="599" fill="#fcd34d" font-size="10" text-anchor="middle">SvelteKit (stateless)</text>

  <rect x="620" y="535" width="170" height="80" rx="5" fill="#451a03" stroke="#f59e0b" stroke-width="2"/>
  <text x="705" y="558" fill="#fcd34d" font-size="12" font-weight="bold" text-anchor="middle">hecate-marthaw</text>
  <text x="705" y="573" fill="#fbbf24" font-size="10" text-anchor="middle">DaemonSet (Web UI)</text>
  <rect x="632" y="585" width="146" height="20" rx="3" fill="#3d2a0a" stroke="#d97706" stroke-width="1"/>
  <text x="705" y="599" fill="#fcd34d" font-size="10" text-anchor="middle">SvelteKit (stateless)</text>

  <!-- No ~/.hecate/ dir label for frontends -->
  <text x="530" y="632" fill="#78716c" font-size="9" text-anchor="middle">Frontends have NO ~/.hecate/ directory. They connect to their daemon's socket.</text>

  <!-- ========== BEAM Cluster boundary ========== -->
  <rect x="50" y="645" width="820" height="50" rx="4" fill="none" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="460" y="667" fill="#c4b5fd" font-size="12" font-weight="bold" text-anchor="middle">BEAM Cluster (Erlang Distribution)</text>
  <text x="460" y="683" fill="#a78bfa" font-size="10" text-anchor="middle">pg process groups | erlang:send/2 | monitors | zero-config within k3s</text>

  <!-- ========== CONNECTION LINES ========== -->

  <!-- hecate-web main view → hecate-daemon socket -->
  <line x1="395" y1="170" x2="330" y2="242" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow-purple)"/>

  <!-- hecate-web trader view → traderw (webview embed) -->
  <line x1="550" y1="170" x2="425" y2="535" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-amber)"/>

  <!-- hecate-web martha view → marthaw (webview embed) -->
  <line x1="680" y1="170" x2="705" y2="535" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-amber)"/>

  <!-- traderw → traderd socket (connects to daemon's socket) -->
  <line x1="425" y1="535" x2="460" y2="510" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow-purple)"/>
  <rect x="432" y="516" width="55" height="14" rx="2" fill="#0f1117"/>
  <text x="460" y="526" fill="#c4b5fd" font-size="8" text-anchor="middle">socket</text>

  <!-- marthaw → marthad socket (connects to daemon's socket) -->
  <line x1="705" y1="535" x2="740" y2="510" stroke="#8b5cf6" stroke-width="2" marker-end="url(#arrow-purple)"/>
  <rect x="712" y="516" width="55" height="14" rx="2" fill="#0f1117"/>
  <text x="740" y="526" fill="#c4b5fd" font-size="8" text-anchor="middle">socket</text>

  <!-- hostPath lines from filesystem to daemon pods -->
  <line x1="330" y1="297" x2="180" y2="370" stroke="#78716c" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="570" y1="297" x2="460" y2="370" stroke="#78716c" stroke-width="1" stroke-dasharray="3,3"/>
  <line x1="850" y1="297" x2="740" y2="370" stroke="#78716c" stroke-width="1" stroke-dasharray="3,3"/>

  <!-- BEAM cluster lines between daemons -->
  <line x1="300" y1="460" x2="340" y2="460" stroke="#a78bfa" stroke-width="2.5" marker-start="url(#arrow)" marker-end="url(#arrow)"/>
  <line x1="580" y1="460" x2="620" y2="460" stroke="#a78bfa" stroke-width="2.5" marker-start="url(#arrow)" marker-end="url(#arrow)"/>

  <!-- gitops → k3s deployment arrow -->
  <line x1="130" y1="270" x2="130" y2="330" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arrow-purple)"/>
  <text x="145" y="305" fill="#a78bfa" font-size="9">Flux</text>

  <!-- ========== LEGEND ========== -->
  <rect x="40" y="715" width="980" height="145" rx="4" fill="#1e1e2e" stroke="#475569" stroke-width="1"/>
  <text x="60" y="737" fill="#e2e8f0" font-size="12" font-weight="bold">Legend</text>

  <!-- Row 1 -->
  <line x1="60" y1="757" x2="100" y2="757" stroke="#8b5cf6" stroke-width="2"/>
  <text x="110" y="761" fill="#c4b5fd" font-size="10">Unix Socket (frontend connects to daemon's socket, no TCP)</text>

  <line x1="530" y1="757" x2="570" y2="757" stroke="#a78bfa" stroke-width="2.5"/>
  <text x="580" y="761" fill="#c4b5fd" font-size="10">BEAM Distribution (daemon to daemon, native)</text>

  <!-- Row 2 -->
  <line x1="60" y1="777" x2="100" y2="777" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="110" y="781" fill="#fbbf24" font-size="10">WebView Embed (hecate-web loads plugin frontend)</text>

  <line x1="530" y1="777" x2="570" y2="777" stroke="#78716c" stroke-width="1.5" stroke-dasharray="4,3"/>
  <text x="580" y="781" fill="#a8a29e" font-size="10">hostPath Mount (daemon data dirs)</text>

  <!-- Row 3 -->
  <line x1="60" y1="797" x2="100" y2="797" stroke="#7c3aed" stroke-width="1.5"/>
  <text x="110" y="801" fill="#a78bfa" font-size="10">GitOps Deployment (Flux watches ~/.hecate/gitops/)</text>

  <!-- Data flow example -->
  <rect x="55" y="815" width="955" height="36" rx="3" fill="#0f1117" stroke="#475569" stroke-width="1"/>
  <text x="65" y="829" fill="#94a3b8" font-size="10" font-weight="bold">Cross-app data flow example (traderw needs venture data from hecate-daemon):</text>
  <text x="65" y="845" fill="#64748b" font-size="10">traderw --(socket)--> traderd --(BEAM)--> hecate-daemon --(BEAM)--> traderd --(socket)--> traderw</text>

  <!-- Key rule -->
  <text x="530" y="868" fill="#fca5a5" font-size="10" text-anchor="middle" font-weight="bold">Frontends NEVER communicate directly. Sockets are owned by daemons. All inter-app data flows via BEAM.</text>

</svg>